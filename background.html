<script type="text/javascript" src="prototype.js"></script>
<script type="text/javascript" src="core.js"></script>
<script type="text/javascript">
	chrome.extension.onRequest.addListener(function(request, sender, sendResponse) {
		var response = { type: request.type };
		
		switch ( request.type ) {
			
			case "db.clear":
				core.db.clear(request.key);
				break;
				
			case "db.get":
				response.key = request.key;
				response.value = core.db.get(request.key);// JSON.parse(localStorage[request.key]);
				break;
				
			case "db.get.all":
				var data = {};
				for ( k in localStorage ) {
					data[k] = core.db.get(k); //JSON.parse(localStorage[k]);
				}
				response.data = data;
				break;
			
			case "db.set":
				core.db.set(request.key, request.value); //localStorage[request.key] = JSON.stringify(request.value);
				break;
		}
		
		sendResponse(response);
	})
	
	chrome.browserAction.onClicked.addListener(function(tab) {
		window.open("http://www.okcupid.com")
	})
	/*
	chrome.browserAction.setPopup({popup:"popup.html"})
	setTimeout(function() {
		chrome.browserAction.setPopup({popup:""})
	}, 1000)
	chrome.browserAction.setBadgeBackgroundColor({color:[255,255,255,100]})
	chrome.browserAction.setBadgeText({text:"1"})
	//*/
</script>